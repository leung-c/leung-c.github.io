<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">

    <title>基于tableview的页面组件化方案 - Code Playground</title>

    <link rel="canonical" href="http://localhost:4000/leung-c.github.io/blog/2017/01/25/Component/">

    <!-- Icons -->
  <link rel="shortcut icon" href="img/favicon.ico">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/leung-c.github.io/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/leung-c.github.io/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/leung-c.github.io/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>






<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/leung-c.github.io/">Code Playground</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/leung-c.github.io/">Home</a>
                </li>
                
                <li>
                    <a href="/leung-c.github.io/about/">About</a>
                </li>
                
                <li>
                    <a href="/leung-c.github.io/archive/">Archive</a>
                </li>
                
                <li>
                    <a href="/leung-c.github.io/milestone/">milestone</a>
                </li>
                
                <li>
                    <a href="/leung-c.github.io/tags/">Tags</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/leung-c.github.io/img/green.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="Tags">
                        
                        <a class="tag" href="/Tags/#objective-c" title="objective-c">objective-c</a>
                        
                        <a class="tag" href="/Tags/#首页" title="首页">首页</a>
                        
                        <a class="tag" href="/Tags/#天猫" title="天猫">天猫</a>
                        
                        <a class="tag" href="/Tags/#京东" title="京东">京东</a>
                        
                        <a class="tag" href="/Tags/#CMS" title="CMS">CMS</a>
                        
                        <a class="tag" href="/Tags/#组件" title="组件">组件</a>
                        
                    </div>
                    <h1>基于tableview的页面组件化方案</h1>
                    
                    <span class="meta">Posted by LC on January 25, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>




<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container">

                <p>什么是页面动态化？</p>
<blockquote>
  <p>本文所说的页面动态化是指：在不修改APP代码的情况，页面的展示形态和数据根据服务端的配置是可变化的。
本文说的组件是指：APP内写好的功能完备的，且支持一定程度的定制化的自定义View。</p>
</blockquote>

<p>对于大多数APP来说，对页面的动态化需求并不高，它们各个页面包括最重要的首页形式上基本不会有很大的改变。如果需要一定的改动，修改代码发新版本，现在的审核速度基本能够满足需求。但是，对于综合电商类APP来说的，某些页面尤其是推广页，根据运营或时效性（各种节日、各种活动）的需要，要求能快速的改头换面营造气氛。</p>

<h4 id="背景">背景</h4>
<p>我们APP的首版上线时，首页的形态是根据UI和PM的设计固定好的。随着业务的发展，对于运营的灵活性要求越来越高，这种灵活性首先就体现APP端：能支持运营人员通过配置控制内容的展示形态，而且控制粒度在“一个独立功能”组件。比如：一个轮播块，只要我给定所需的图片资源，他就可以工作，不依赖于其他的功能组件。</p>

<h4 id="组件化">组件化</h4>
<p>运营对于页面动态控制实际是通过对页面配置组件实现的，所以问题的核心就是：</p>
<ol>
  <li>APP端需要提供一套组件库，每种组件对外有一个组件标识，运营将所需的组件配置到页面上，并配置好数据源。</li>
  <li>进入APP页面时，获取该页面的配置，加载对应组件，填充数据。</li>
</ol>

<p>第一个问题比较好解决，我们根据UI和PM的设计可以确定好有哪几种组件，每种对应封装好一个View即可，当然这里实现时要考虑有很多细节。难点就在与第二个问题：组件以何种方式加载？一种类型的组件可以有多个，如何支持复用？组件的位置布局如何确定？</p>

<h5 id="uiscrollview">UIScrollView</h5>
<p>最初的方案是使用UIScrollView来承载组件，将组件作为子View一个个添加到UIScrollView中，但是考虑之后放弃了，因为需要自己维护ContentSize，并且需要实现类似TableView的复用机制，这两项都可以做到但是比较耗费成本，可能实现高效复用机制的时间要比实现所有组件还多，当然使用UIScrollView来做可以完全自己掌控组件的加载，就看我们怎么取舍。那么，我们能否利用TableView现有的复用机制呢？</p>

<h5 id="没有cell的uitableview">没有Cell的UITableView</h5>
<p>使用TableView的话ContentSize不需要我们维护了，我们要在heightForRow等代理方法中返回该位置组件的高度即可，它会自动计算好。那么，tableView的复用机制我们怎么利用呢？TableView的dequeueReusableCellWithIdentifier根据复用ID返回的是一个Cell，是否用Cell实现组件或者用Cell再把组件封装一层？因为使用TableView的大多数情况下我们是在和Cell打交道，所以会形成思维定势。其实SectionHeaderView也是可以支持复用的，我们完全可以把组件作为TableView的SectionHeaderView，后台配置了多少个组件就有多少个Section，只是这个Section中没有Cell。</p>
<h4 id="uitableviewheaderfooterview">UITableViewHeaderFooterView</h4>
<p>这里有一个小限制，复用的SectionHeaderView必须是UITableViewHeaderFooterView类型，意味着我们组件的基类必须是UITableViewHeaderFooterView，为了避免每个组件直接继承自UITableViewHeaderFooterView，我们新建了一个ComponentBaseView，作为组件的基类，并且定义了所有组件通用的属性和方法（方法具体由各个子类自己实现），起到一个抽象类的作用。其大致形式如下：</p>
<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">ComponentBaseView</span>
<span class="cm">/**
 设置组件数据数据
 */</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">setData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">id</span><span class="p">)</span><span class="nv">data</span><span class="p">;</span>
<span class="cm">/**
 根据复用标识id实例化组件
 */</span>
<span class="k">-</span> <span class="p">(</span><span class="n">nonnull</span> <span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithReuseIdentifier</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">reuseIdentifier</span><span class="p">;</span>

<span class="cm">/**
 根据数据返回该组件的高度
 */</span>
<span class="k">+</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="nf">heightForData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">id</span><span class="p">)</span><span class="nv">data</span><span class="p">;</span>

<span class="cm">/**
 组件的复用ID
 */</span>
<span class="k">+</span> <span class="p">(</span><span class="n">nonnull</span> <span class="n">NSString</span><span class="o">*</span><span class="p">)</span> <span class="n">reuseId</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre></div></div>
<p>通过基类我们可以对组件统一的行为进行管理，比如每种组件都支持背景图、背景色、阴影等等。组件的高度是多少组件自己是最清楚的，不管固定的高度或者动态计算的高度我们希望都有组件自己决定，而heightForRowAtIndexPath这个代理方法调用非常频繁，不可能创建好组件填充好数据后再返回组件对象的高度，所以我们将heightForData定义成类方法。</p>

<p>每种组件的实现就很简单了，继承自ComponentBaseView，写好组件的功能即可，接下来就剩组件的加载过程了。</p>

<h4 id="componentcontainerscrollview">ComponentContainerScrollView</h4>
<p>理论上我们的组件可以用与普通的TableView，但是我们的组件加载有其特殊性：我们需要根据组件类型去实例化并加载组件。为了方便管理组件的加载过程，我们创建了一个ComponentContainerScrollView类来作为专门承载组件的容器，它继承自UITableView，并且其代理和数据源代理是其本身。</p>
<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">ComponentContainerScrollView</span> <span class="p">:</span> <span class="nc">UITableView</span>
<span class="c1">//组件数据源
</span>
<span class="k">@property</span><span class="p">(</span><span class="n">strong</span><span class="p">,</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">ComponentViewModel</span><span class="o">*&gt;*</span> <span class="n">components</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">ComponentViewModel</span> <span class="p">:</span> <span class="nc">NSObject</span>

<span class="c1">//组件的唯一标示，复用标识
</span>
<span class="k">@property</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span><span class="o">*</span> <span class="n">identifier</span><span class="p">;</span>

<span class="c1">//用于组件展示的数据
</span>
<span class="k">@property</span><span class="p">(</span><span class="n">strong</span><span class="p">,</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">id</span> <span class="n">data</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">ComponentContainerScrollView</span>

<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span> <span class="nf">initWithFrame</span><span class="p">:(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">frame</span><span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">initWithFrame</span><span class="p">:</span><span class="n">frame</span> <span class="nf">style</span><span class="p">:(</span><span class="n">UITableViewStyleGrouped</span><span class="p">)];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="c1">//默认是没有cell的
</span>    
    <span class="n">self</span><span class="p">.</span><span class="n">rowHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">separatorStyle</span> <span class="o">=</span> <span class="n">UITableViewCellSeparatorStyleNone</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></div></div>
<p>我们实现TableView的代理和数据源方法</p>
<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//组件的个数
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span> <span class="nf">numberOfSectionsInTableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span><span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//组件高度
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForHeaderInSection</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span><span class="p">{</span>
    <span class="n">ComponentViewModel</span> <span class="o">*</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">components</span> <span class="nf">safeObjectAtIndex</span><span class="p">:</span><span class="n">section</span><span class="p">];</span>
    <span class="n">Class</span> <span class="n">class</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ComponentBuilder</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">componentTypeForIdentifier</span><span class="p">:</span><span class="n">model</span><span class="p">.</span><span class="n">identifier</span><span class="p">];</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">class</span> <span class="nf">heightForData</span><span class="p">:</span><span class="n">model</span><span class="p">];</span>    
<span class="p">}</span>

<span class="c1">//创建组件
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">UIView</span><span class="o">*</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">viewForHeaderInSection</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span><span class="p">{</span>
    <span class="n">ComponentViewModel</span> <span class="o">*</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">components</span> <span class="nf">safeObjectAtIndex</span><span class="p">:</span><span class="n">section</span><span class="p">];</span>
    <span class="n">ComponentContainerScrollView</span> <span class="o">*</span><span class="n">view</span> <span class="o">=</span> <span class="p">(</span><span class="n">ComponentContainerScrollView</span><span class="o">*</span><span class="p">)[</span><span class="n">tableView</span> <span class="nf">dequeueReusableHeaderFooterViewWithIdentifier</span><span class="p">:</span><span class="n">model</span><span class="p">.</span><span class="n">identifier</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">view</span><span class="o">==</span><span class="nb">nil</span><span class="p">){</span>
        <span class="n">view</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ComponentBuilder</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">componentWithIdentifier</span><span class="p">:</span><span class="n">model</span><span class="p">.</span><span class="n">identifier</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">view</span> <span class="nf">setData</span><span class="p">:</span><span class="n">model</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">view</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>这里面我们用到了一个重要但是实际很简单的一个类：ComponentBuilder，根据类名可以看出，它负责组件的创建，外部给定一个组件标识它创建并返回一个组件，同时也提供一个方法根据标识返回组件的类。</p>

<p>ComponentBuilder的内部实际维护了一个组件标识符和组件类的一个映射，期内部的实现大致如下：</p>
<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@implementation</span> <span class="nc">ComponentBuilder</span>
<span class="p">{</span>
    <span class="n">NSMutableDictionary</span><span class="o">*</span> <span class="n">_components</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">ComponentBaseView</span><span class="o">*</span><span class="p">)</span> <span class="n">componentWithIdentifier</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">componentId</span><span class="p">{</span>
    <span class="n">Class</span> <span class="n">viewType</span> <span class="o">=</span> <span class="n">_components</span><span class="p">[</span><span class="nf">componentId</span><span class="p">];</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">viewType</span><span class="p">){</span>
        <span class="k">return</span>  <span class="p">[[</span><span class="n">viewType</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithReuseIdentifier</span><span class="p">:</span><span class="n">componentId</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">registerComponentType</span><span class="o">:</span><span class="p">(</span><span class="n">Class</span><span class="p">)</span><span class="n">componentClass</span> <span class="n">forIdentifier</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">componentId</span><span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">_components</span><span class="p">){</span>
        <span class="n">_components</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableDictionary</span> <span class="nf">new</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">_components</span><span class="p">[</span><span class="nf">componentId</span><span class="p">]</span> <span class="o">=</span> <span class="n">componentClass</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">Class</span><span class="p">)</span> <span class="n">componentTypeForIdentifier</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span> <span class="n">componnentId</span><span class="p">{</span>
    <span class="k">return</span> <span class="n">_components</span><span class="p">[</span><span class="nf">componnentId</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>
<p>registerComponentType用于注册一个组件类型到ComponentBuilder，这个方法由组件调用，在每个组件load方法中调用这个方法，每个类的load方法由系统在程序启动时执行，这样可以保证我们程序启动后所有的组件都是已注册状态。</p>

<p>接下来，我们只需要创建一个VC来作为动态化页面的入口，完成网络请求并设置组件容的数据源，这个基于TableView的页面组件化加载差不多就完成了，当然了，这还只是一个非常简单仅仅可用的状态。</p>
<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">ComponentViewController</span> <span class="p">:</span> <span class="nc">UIViewController</span>
<span class="cm">/**
 页面ID
 */</span>
<span class="k">@property</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span><span class="o">*</span> <span class="n">pageId</span><span class="p">;</span>
<span class="k">@end</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span><span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">componentView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ComponentContainerScrollView</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kScreenWidth</span><span class="p">,</span> <span class="n">kScreenHeight</span><span class="p">)];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">componentView</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">componentView</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">top</span><span class="p">.</span><span class="n">bottom</span><span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">loadData</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">loadData</span><span class="p">{</span>
    <span class="n">WEAKSELF</span><span class="p">;</span>
    <span class="p">[</span><span class="n">_manger</span> <span class="nf">requestForPage</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">pageId</span> <span class="nf">components</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">,</span><span class="n">NSArray</span> <span class="o">*</span><span class="n">array</span><span class="p">){</span>
        <span class="n">weakSelf</span><span class="p">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">array</span><span class="p">;</span>
        <span class="n">weakSelf</span><span class="p">.</span><span class="n">componentView</span><span class="p">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">weakSelf</span><span class="p">.</span><span class="n">components</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}</span>
</code></pre></div></div>

<h5 id="支持cell的组件容器">支持Cell的组件容器</h5>
<p>前面我们提到了，我们把组件作为tableView的sectionHeaderView来加载，所以实际是不需要用到cell的。但是，如果我们的组件形式是类似于下面这样的呢：
<img src="https://ws2.sinaimg.cn/large/006tNc79gy1fnp4vxowf8j30ku0qytgo.jpg" alt="" /></p>

<p>按照之前的设计，这是一个组件作为一个HeaderView，意味着上面的“附近店铺”和下面的店铺列表是一个View里面的，它的复用级别是这个View整体来复用的。我门创建这个HeaderView时根据数据创建对应数量的“店铺信息”子view，这个HeaderView复用时还需要根据此时的数据来“多退少补”-多的view要隐藏，少的view要补充创建。如果同样的组件有多个，而且数据个数不一样时，快速的来回滚动，会有瞬间的一丝卡顿，虽然不明显的影响用户体验。</p>

<p>理想中的做法是店铺信息能用Cell来展示，这样复用的话不仅粒度较小节省内存和解决滑动的问题，而起维护非常简单，不存在“多退少补”的问题。</p>

<p>那么，组件能否用cell呢？回到我们的组件容器ComponentContainerScrollView中，它实现了TableView的代理方法，但是实际每个位置的view是什么，高度是什么等等这些全部是交给组件类决定的，具体的实现是通过调用的组件的类方法。所以这个组件需不需要cell，用什么cell，cell有多高是不是也可以由组件自身决定呢？根据SectionHeader的加载过程，我们可以用同样的方式实现组件容器Cell的加载。</p>

<p>ComponentBaseView修改如下:</p>
<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 设置组件数据数据
 */</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">setData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">id</span><span class="p">)</span><span class="nv">data</span><span class="p">;</span>
<span class="cm">/**
 根据复用标识id实例化组件
 */</span>
<span class="k">-</span> <span class="p">(</span><span class="n">nonnull</span> <span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithReuseIdentifier</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">reuseIdentifier</span><span class="p">;</span>

<span class="cm">/**
 根据数据返回该组件的高度
 */</span>
<span class="k">+</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="nf">heightForData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">id</span><span class="p">)</span><span class="nv">data</span><span class="p">;</span>

<span class="cm">/**
 如果组件的数据需要cell的显示，需要实现以下方法
 */</span>

<span class="c1">//cell的个数
</span>
<span class="k">+</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span> <span class="nf">cellRowsAtIndexPath</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSIndexPath</span><span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">forData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">ComponentViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">model</span><span class="p">;</span>

<span class="c1">//cell的高度
</span>
<span class="k">+</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="nf">cellHeightAtIndexPath</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSIndexPath</span><span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">forData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">ComponentViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">model</span><span class="p">;</span>

<span class="c1">//返回一个cell
</span>
<span class="k">+</span> <span class="p">(</span><span class="n">nullable</span> <span class="n">UITableViewCell</span><span class="o">*</span><span class="p">)</span><span class="nf">cellForTableView</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">UITableView</span><span class="o">*</span><span class="p">)</span><span class="nv">table</span> <span class="nf">atIndexPath</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">withData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">ComponentViewModel</span> <span class="o">*</span><span class="p">)</span><span class="nv">model</span><span class="p">;</span>

<span class="c1">//点击了一个cell
</span>
<span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">tableView</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">UITableView</span><span class="o">*</span><span class="p">)</span><span class="nv">table</span> <span class="nf">didSelectRowAtIndexPath</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">withData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">oComponentViewModel</span> <span class="o">*</span><span class="p">)</span><span class="nv">model</span><span class="p">;</span>

<span class="cm">/**
 组件的复用ID
 */</span>
<span class="k">+</span> <span class="p">(</span><span class="n">nonnull</span> <span class="n">NSString</span><span class="o">*</span><span class="p">)</span> <span class="n">reuseId</span><span class="p">;</span>

<span class="k">@end</span>

</code></pre></div></div>

<p>ComponentViewController修改如下：</p>
<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@implementation</span> <span class="nc">ComponentContainerScrollView</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span> <span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span>
<span class="p">{</span>
    <span class="n">ComponentViewModel</span> <span class="o">*</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">components</span> <span class="nf">safeObjectAtIndex</span><span class="p">:</span><span class="n">section</span><span class="p">];</span>
    <span class="n">Class</span> <span class="n">class</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CMSComponentBuilder</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">componentTypeForIdentifier</span><span class="p">:</span><span class="n">model</span><span class="p">.</span><span class="n">identifier</span><span class="p">];</span>
    <span class="k">return</span>  <span class="p">[</span><span class="n">class</span> <span class="nf">cellRowsAtIndexPath</span><span class="p">:[</span><span class="n">NSIndexPath</span> <span class="nf">indexPathForRow</span><span class="p">:</span><span class="mi">0</span> <span class="nf">inSection</span><span class="p">:</span><span class="n">section</span><span class="p">]</span> <span class="n">forData</span><span class="o">:</span><span class="n">model</span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">//cell高度
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
<span class="p">{</span>
    <span class="n">ComponentViewModel</span> <span class="o">*</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">components</span> <span class="nf">safeObjectAtIndex</span><span class="p">:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">];</span>
    <span class="n">Class</span> <span class="n">class</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CMSComponentBuilder</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">componentTypeForIdentifier</span><span class="p">:</span><span class="n">model</span><span class="p">.</span><span class="n">identifier</span><span class="p">];</span>
    <span class="k">return</span>  <span class="p">[</span><span class="n">class</span> <span class="nf">cellHeightAtIndexPath</span><span class="p">:</span><span class="n">indexPath</span> <span class="nf">forData</span><span class="p">:</span><span class="n">model</span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">//创建cell
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span><span class="o">*</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
<span class="p">{</span>
    <span class="n">ComponentViewModel</span> <span class="o">*</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">components</span> <span class="nf">safeObjectAtIndex</span><span class="p">:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">];</span>
    <span class="n">Class</span> <span class="n">class</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CMSComponentBuilder</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">componentTypeForIdentifier</span><span class="p">:</span><span class="n">model</span><span class="p">.</span><span class="n">identifier</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">class</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span>  <span class="p">[[</span><span class="n">UITableViewCell</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">initWithStyle</span><span class="p">:(</span><span class="n">UITableViewCellStyleDefault</span><span class="p">)</span> <span class="nf">reuseIdentifier</span><span class="p">:</span><span class="n">EmptyString</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span>  <span class="p">[</span><span class="n">class</span> <span class="nf">cellForTableView</span><span class="p">:</span><span class="n">tableView</span> <span class="nf">atIndexPath</span><span class="p">:</span><span class="n">indexPath</span> <span class="n">withData</span><span class="o">:</span><span class="n">model</span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">//组件的加载
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span> <span class="nf">numberOfSectionsInTableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//组件高度
</span><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForHeaderInSection</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span><span class="p">{</span>
    <span class="n">ComponentViewModel</span> <span class="o">*</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">components</span> <span class="nf">safeObjectAtIndex</span><span class="p">:</span><span class="n">section</span><span class="p">];</span>
    <span class="n">Class</span> <span class="n">class</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ComponentBuilder</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">componentTypeForIdentifier</span><span class="p">:</span><span class="n">model</span><span class="p">.</span><span class="n">identifier</span><span class="p">];</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">class</span> <span class="nf">heightForData</span><span class="p">:</span><span class="n">model</span><span class="p">];</span>    
<span class="p">}</span>
<span class="c1">//组件创建
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">UIView</span><span class="o">*</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">viewForHeaderInSection</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span>
<span class="p">{</span>
    <span class="n">ComponentViewModel</span> <span class="o">*</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">components</span> <span class="nf">safeObjectAtIndex</span><span class="p">:</span><span class="n">section</span><span class="p">];</span>
    <span class="n">ComponentContainerScrollView</span> <span class="o">*</span><span class="n">view</span> <span class="o">=</span> <span class="p">(</span><span class="n">ComponentContainerScrollView</span><span class="o">*</span><span class="p">)[</span><span class="n">tableView</span> <span class="nf">dequeueReusableHeaderFooterViewWithIdentifier</span><span class="p">:</span><span class="n">model</span><span class="p">.</span><span class="n">identifier</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">view</span><span class="o">==</span><span class="nb">nil</span><span class="p">){</span>
        <span class="n">view</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ComponentBuilder</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">componentWithIdentifier</span><span class="p">:</span><span class="n">model</span><span class="p">.</span><span class="n">identifier</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">view</span> <span class="nf">setData</span><span class="p">:</span><span class="n">model</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">view</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">didSelectRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
<span class="p">{</span>
    <span class="n">ComponentViewModel</span> <span class="o">*</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">components</span> <span class="nf">safeObjectAtIndex</span><span class="p">:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">];</span>
    <span class="n">Class</span> <span class="n">class</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CMSComponentBuilder</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">componentTypeForIdentifier</span><span class="p">:</span><span class="n">model</span><span class="p">.</span><span class="n">identifier</span><span class="p">];</span>
    
    <span class="p">[</span><span class="n">class</span> <span class="nf">cellForTableView</span><span class="p">:</span><span class="n">tableView</span> <span class="nf">didSelectRowAtIndexPath</span><span class="p">:</span><span class="n">indexPath</span> <span class="n">withData</span><span class="o">:</span><span class="n">model</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></div></div>

<p>对于某一个需要使用cell的组件来说只需要实现基类定义的cell相关方法就可以了，还是以上面的“附件的店铺”为例：</p>
<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">NearbyStoreView</span><span class="p">:</span><span class="nc">ComponentBaseView</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">NearbyStoreView</span>
<span class="cm">/**
 这里只需要设置头部的数据
 */</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">setData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">id</span><span class="p">)</span><span class="nv">data</span><span class="p">{</span>
    <span class="n">slef</span><span class="p">.</span><span class="n">titleLabel</span> <span class="o">=</span> <span class="s">@"—————— 附近的店铺 ————————"</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/**
 根据复用标识id实例化组件
 */</span>
<span class="k">-</span> <span class="p">(</span><span class="n">nonnull</span> <span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithReuseIdentifier</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">reuseIdentifier</span><span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">supper</span> <span class="nf">initWithReuseIdentifier</span><span class="p">:[</span><span class="n">self</span> <span class="nf">className</span><span class="p">]];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">){</span>
        <span class="n">UILabel</span> <span class="o">*</span><span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UILabel</span> <span class="nf">alloc</span><span class="p">]</span><span class="nf">init</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">label</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
 这里只需要返回头部的高度即可，cell的高度由cell相关方法返回。
 */</span>
<span class="k">+</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="nf">heightForData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">id</span><span class="p">)</span><span class="nv">data</span><span class="p">{</span>
    <span class="k">return</span> <span class="mi">50</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//cell的个数
</span>
<span class="k">+</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span> <span class="nf">cellRowsAtIndexPath</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSIndexPath</span><span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">forData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">ComponentViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">model</span><span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">model</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="s">@"stores"</span><span class="p">]</span> <span class="nf">count</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">//cell的高度
</span>
<span class="k">+</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="nf">cellHeightAtIndexPath</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSIndexPath</span><span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">forData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">ComponentViewModel</span><span class="o">*</span><span class="p">)</span><span class="nv">model</span><span class="p">{</span>
    <span class="n">reurn</span> <span class="mi">150</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//返回一个cell
</span>
<span class="k">+</span> <span class="p">(</span><span class="n">nullable</span> <span class="n">UITableViewCell</span><span class="o">*</span><span class="p">)</span><span class="nf">cellForTableView</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">UITableView</span><span class="o">*</span><span class="p">)</span><span class="nv">table</span> <span class="nf">atIndexPath</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">withData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">ComponentViewModel</span> <span class="o">*</span><span class="p">)</span><span class="nv">model</span><span class="p">{</span>
    <span class="n">StroreInfoCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span>  <span class="p">[</span><span class="n">StroreInfoCell</span> <span class="nf">cellForTableView</span><span class="p">:</span><span class="n">table</span><span class="p">];</span>
    <span class="n">NSArray</span> <span class="o">*</span><span class="n">stores</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="s">@"stores"</span><span class="p">];</span>
    <span class="n">cell</span><span class="p">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">stores</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="nf">row</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//点击了一个cell
</span>
<span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">tableView</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">UITableView</span><span class="o">*</span><span class="p">)</span><span class="nv">table</span> <span class="nf">didSelectRowAtIndexPath</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">withData</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">oComponentViewModel</span> <span class="o">*</span><span class="p">)</span><span class="nv">model</span><span class="p">{</span>
    <span class="n">StoreVC</span> <span class="o">*</span><span class="n">vc</span> <span class="o">=</span> <span class="p">[[</span><span class="n">StoreVC</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">VC</span><span class="p">.</span><span class="n">naviController</span> <span class="nf">pushViewController</span><span class="p">:</span><span class="n">vc</span> <span class="nf">animated</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
<span class="p">}</span>

<span class="cm">/**
 组件的复用ID
 */</span>
<span class="k">+</span> <span class="p">(</span><span class="n">nonnull</span> <span class="n">NSString</span><span class="o">*</span><span class="p">)</span> <span class="n">reuseId</span><span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">className</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></div></div>
<p>现在，组件的形式可以很灵活了，它也可以全部只有cell，整个装载过程我们将组件的形式、行为完全交给它自身管理，外部在相关处理点调用对应的方法即可，相关类的交互过程如下：</p>
<pre><code class="language-sequence">ComponentBaseView-&gt;ComponentBuilder: +Regist
Note left of ComponentBaseView: SubClassImplement
Note right of ComponentContainer: TableView Delegate&amp;DataSource\nMethods

ComponentBuilder-&gt;ComponentContainer:GetComponent
ComponentBaseView--&gt;ComponentContainer: +numberOfRows
ComponentBaseView--&gt;ComponentContainer: +heightForHeaderView\n+heightForCell
ComponentBaseView--&gt;ComponentContainer: +ViewtForSection\n+CellForRow
</code></pre>



                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/leung-c.github.io/blog/2016/12/23/CategoryOfView/" data-toggle="tooltip" data-placement="top" title="利用分类让你的view强大起来">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/leung-c.github.io/blog/2017/03/05/ClassCategory/" data-toggle="tooltip" data-placement="top" title="由MVC框架下常见的代码问题想到的">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Duoshuo Share start -->
                <style>
                    .ds-share{
                        text-align: right;
                    }
                    
                    @media only screen and (max-width: 700px) {
                        .ds-share {

                        }
                    }
                </style>

                <div class="ds-share"
                    data-thread-key="/blog/2017/01/25/Component" data-title="基于tableview的页面组件化方案"
                    data-images="http://localhost:4000/img/green.jpg"
                    data-content="什么是页面动态化？

  本文所说的页面动态化是指：在不修改APP代码的情况，页面的展示形态和数据根据服务端的配置是可变化的。
本文说的组件是指：APP内... | Microdust:Azeril's blog"
                    data-url="http://localhost:4000/blog/2017/01/25/Component/">
                    <div class="ds-share-inline">
                      <ul  class="ds-share-icons-16">

                        <li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">分享到：</a></li>
                        <li><a class="ds-wechat flat" href="javascript:void(0);" data-service="wechat">微信</a></li>
                        <li><a class="ds-weibo flat" href="javascript:void(0);" data-service="weibo">微博</a></li>
                        <li><a class="ds-douban flat" href="javascript:void(0);" data-service="douban">豆瓣</a></li>
                      </ul>
                      <div class="ds-share-icons-more">
                      </div>
                    </div>
                <hr>
                </div>
                <!-- Duoshuo Share end-->


                <!-- 多说评论框 start -->
                <div class="comment">
                    <div class="ds-thread" data-thread-key="/blog/2017/01/25/Component" data-title="基于tableview的页面组件化方案" data-url="http://localhost:4000/blog/2017/01/25/Component/"></div>
                </div>
                <!-- 多说评论框 end -->
            </div>
        </div>
    </div>
</article>

<script src="/leung-c.github.io/js/jquery.min.js"></script>
<script src="/leung-c.github.io/js/raphael.min.js"></script>
<script src="/leung-c.github.io/js/mermaid.full.js"></script>
<script src="/leung-c.github.io/js/flowchart.min.js"></script>
<script src="/leung-c.github.io/js/jquery.flowchart.min.js"></script>
<script src="/leung-c.github.io/js/webfont.js"></script>
<script src="/leung-c.github.io/js/snap.svg-min.js"></script>
<script src="/leung-c.github.io/js/underscore-min.js"></script>
<script src="/leung-c.github.io/js/sequence-diagram.min.js"></script>

<script>
    $(".language-sequence").sequenceDiagram({theme: 'simple'});
    $(".diagram").sequenceDiagram({theme: 'simple'});

</script>
<script>
	function flow(name,f)
	{
        var chart = flowchart.parse(f);
        chart.drawSVG(name);
	}

	window.onload = function () 
	{
		var cd = document.getElementsByClassName("flow");
		for (var i = 0; i < cd.length; i++) 
		{
			var t = cd[i].getElementsByClassName("flowcode")[0].value;
			var canvas = "canvas" + i;
			cd[i].innerHTML = "<div id=\"" + canvas + "\"></div>"
			flow(canvas, t);
		}
        
	}
</script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: ''
        };
        anchors.add().remove('.intro-header h1').remove('.subheading');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <!-- kill the Facebook and Weibo -->
                    <li>
                        <a href="/leung-c.github.io/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    
                    <!--
                    
                    -->

                    <!--
                    
                    -->

                    
                    <!--
                    
                    -->

                </ul>
                <p class="copyright text-muted">
                &copy; 2018 LiangChao ❖ Powered by Jekyll.
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/leung-c.github.io/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/leung-c.github.io/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/leung-c.github.io/js/clean-blog.min.js "></script>



<!-- Highlight.js -->
<script>
    async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js",function(){
        hljs.initHighlightingOnLoad();
    })
</script>
<link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">


</body>

</html>